@page "/wealthmap"
@using MWRCheatSheet.Model
@using MWRCheatSheet.Components
@inject MWRCheatSheet.Model.UISettings UI

<MudTimeline>
    <MudTimelineItem Color="Color.Info" Size="Size.Small">
        <ItemOpposite>
            <MudText Color="Color.Info" Typo="Typo.h5">1970</MudText>
        </ItemOpposite>
        <ItemContent>
            <MudText Color="Color.Info" Typo="Typo.h6" GutterBottom="true">Atom Towns</MudText>
            <MudText>Construction of the town of Pripyat, one of 9 “atom towns” begins, to be inhabited by future employees of the nuclear power plants.</MudText>
        </ItemContent>
    </MudTimelineItem>
    <MudTimelineItem Color="Color.Success" Size="Size.Small">
        <ItemOpposite>
            <MudText Color="Color.Success" Typo="Typo.h5">1977</MudText>
        </ItemOpposite>
        <ItemContent>
            <MudText Color="Color.Success" Typo="Typo.h6" GutterBottom="true">Operational</MudText>
            <MudText>The first of the Chernobyl Nuclear Power Plants four reactors is ready to operate followed by number 2 in 1978.</MudText>
        </ItemContent>
    </MudTimelineItem>
    <MudTimelineItem Color="Color.Error" Size="Size.Small">
        <ItemOpposite>
            <MudText Color="Color.Error" Typo="Typo.h5">1979</MudText>
        </ItemOpposite>
        <ItemContent>
            <MudText Color="Color.Error" Typo="Typo.h6" GutterBottom="true">Pripyat</MudText>
            <MudText>Pripyat officially proclaimed as a city.<br />The Chernobyl Atomic Power Station reaches its first 10 billion kilowatt-hours of electical output.</MudText>
        </ItemContent>
    </MudTimelineItem>
</MudTimeline>

<MudChipSet @bind-SelectedChips="_selected" MultiSelection="true" Filter="true">
    @foreach(var filterableValueable in Highlights)
    {
        <MudChip Text="@(filterableValueable.Description)" Color="Color.Primary" SelectedColor="Color.Secondary" />
    }
</MudChipSet>
<br/>
<MudStack>
    @foreach(var testimonial in UI.EnglishLocale.Testimonials)
    {
        switch(testimonial.Video.Platform)
        {
            case VideoPlatform.TikTok:
                <Testimonial Description="@testimonial.Description"
                             TikTok="@((testimonial.Video.UserHandle, testimonial.Video.Id))"
                             Highlights="@(testimonial.Highlights)"
                             Filter="@(GetHighlights(_selected))" />
                break;

            case VideoPlatform.YouTube:
                <Testimonial Description="@testimonial.Description"
                             YouTube="@testimonial.Video.Id"
                             Highlights="@(testimonial.Highlights)"
                             Filter="@(GetHighlights(_selected))" />
                break;

            case VideoPlatform.Vimeo:
                <Testimonial Description="@testimonial.Description"
                             Vimeo="@((testimonial.Video.Id, testimonial.Video.Hash))"
                             Highlights="@(testimonial.Highlights)"
                             Filter="@(GetHighlights(_selected))" />
                break;
        }
    }

    <!--
        The hidden component below is a UI hack.  I don't know why, but if you make the component below visible,
        and you click play on the video, the video DIRECTLY ABOVE IT will start playing.  This seems to always
        apply to the last video on the page.  Thus, the hack is to make the last video hidden.
        - Jerome Bell
    -->
    <div style="visibility:hidden;">
        <Testimonial Description="This testimonial is a UI hack, see comment above."
                     YouTube="Xlg3rp0D4aI"
                     Highlights="@([Highlight.MoneyChallenge])"
                     Filter="@([Highlight.MoneyChallenge])" />
    </div>
</MudStack>

@code {
    private static readonly (Highlight Highlight, string Description)[] Highlights =
    [
        (Highlight.MoneyChallenge, "72Hr Money Challenge"),
        (Highlight.ReduceMyTaxes, "Reduce My Taxes"),
        (Highlight.EliminateMyDebt, "Eliminate My Debt"),
        (Highlight.LowerMyBills, "Lower My Bills"),
        (Highlight.RestoreMyCredit, "Restore My Credit"),
        (Highlight.DCA, "DCA"),
        (Highlight.PRA, "PRA"),
        (Highlight.LandBanking, "Land Banking"),
        (Highlight.PreciousMetals, "Precious Metals"),
        (Highlight.TrustMyAssets, "Trust My Assets"),
        (Highlight.KeysToHomeOwnership, "Keys to Home Ownership"),
        (Highlight.Bonuses, "Bonuses"),
        (Highlight.Residuals, "Residuals"),
        (Highlight.Couple, "Couple"),
        (Highlight.Military, "Military"),
        (Highlight.GenYGenZ, "Millenial/GenZ"),
    ];

    private MudChip[] _selected = [];

    private static Highlight[] GetHighlights(MudChip[] chips)
        => !chips.Any() ? [] : chips.Select(chip => Highlights.First(v => v.Description == chip.Text).Highlight).ToArray();
}