@using MWRCheatSheet.Model
@inherits Components.ComponentBase

<div style="display:@_display;">
    @if (this.YouTube != null)
    {
        <iframe @onload="OnVideoLoaded"
                src="@($"{Constants.YouTubeEmbedLinkPrefix}{YouTube}")"
                width="560"
                height="315"
                title="YouTube video player"
                frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen>
        </iframe>
    }

    @if(this.TikTok != null)
    {
        <blockquote class="tiktok-embed" cite="https://www.tiktok.com/@@@(this.TikTok.Value.UserHandle)/video/@TikTok" data-video-id="@TikTok.Value.VideoId" style="max-width: 605px;min-width: 325px;">
            <section />
        </blockquote>
        <script async src="https://www.tiktok.com/embed.js"></script>
    }
</div>

@if (!_iframeLoaded)
{
    <MudSkeleton SkeletonType="SkeletonType.Rectangle" Width="auto" Height="100px;" />
}
@code {
    private bool _iframeLoaded;
    private string _display = "none";

    [Parameter]
    public string? YouTube { get; set; }

    [Parameter]
    public (string UserHandle, string VideoId)? TikTok { get; set; }

    protected override void OnInitialized()
    {
        if(this.TikTok != null)
        {
            this.ShowVideo();
        }
    }

    private void OnVideoLoaded(ProgressEventArgs e)
    {
        this.ShowVideo();
    }

    private void ShowVideo()
    {
        _iframeLoaded = true;
        _display = "block";
    }
}
